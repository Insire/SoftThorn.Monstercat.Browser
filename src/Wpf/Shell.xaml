<mahControls:MetroWindow x:Class="SoftThorn.Monstercat.Browser.Wpf.Shell"
                         xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
                         xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
                         xmlns:mahControls="http://metro.mahapps.com/winfx/xaml/controls"
                         xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
                         xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
                         xmlns:i="http://schemas.microsoft.com/xaml/behaviors"
                         xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
                         xmlns:iconpacks="clr-namespace:MahApps.Metro.IconPacks;assembly=MahApps.Metro.IconPacks.FontAwesome"
                         xmlns:core="clr-namespace:SoftThorn.Monstercat.Browser.Core;assembly=SoftThorn.Monstercat.Browser.Core"
                         xmlns:local="clr-namespace:SoftThorn.Monstercat.Browser.Wpf"
                         xmlns:system="clr-namespace:System;assembly=mscorlib"
                         Title="SoftThorn.Monstercat.Browser.Wpf"
                         Width="800"
                         Height="820"
                         d:DataContext="{d:DesignInstance Type=core:ShellViewModel,
                                                          IsDesignTimeCreatable=False}"
                         Background="{DynamicResource MaterialDesignPaper}"
                         BorderBrush="#FF673AB7"
                         FontFamily="{DynamicResource MaterialDesignFont}"
                         GlowBrush="{DynamicResource PrimaryHueMidBrush}"
                         TextElement.FontSize="13"
                         TextElement.FontWeight="Regular"
                         TextElement.Foreground="{DynamicResource MaterialDesignBody}"
                         TextOptions.TextFormattingMode="Ideal"
                         TextOptions.TextRenderingMode="Auto"
                         TitleCharacterCasing="Normal"
                         WindowTitleBrush="#FF673AB7"
                         mc:Ignorable="d">

    <mahControls:MetroWindow.Resources>
        <local:BindingProxy x:Key="BindingProxy" Data="{Binding}" />
    </mahControls:MetroWindow.Resources>

    <i:Interaction.Triggers>
        <i:EventTrigger EventName="Loaded">
            <i:InvokeCommandAction Command="{Binding RefreshCommand}" />
        </i:EventTrigger>
    </i:Interaction.Triggers>

    <materialDesign:TransitioningContent>
        <materialDesign:TransitioningContent.OpeningEffects>
            <materialDesign:TransitionEffect Kind="FadeIn" />
            <materialDesign:TransitionEffect Kind="SlideInFromBottom" />
        </materialDesign:TransitioningContent.OpeningEffects>

        <materialDesign:DialogHost IsOpen="{Binding IsDialogOpen, Mode=TwoWay}">

            <!--  Dialog  -->
            <materialDesign:DialogHost.DialogContent>
                <DockPanel Margin="16">
                    <TextBlock DockPanel.Dock="Top" Text="Download files to this folder" />

                    <StackPanel DockPanel.Dock="Bottom" Orientation="Horizontal">
                        <Button Margin="0,8,8,0"
                                Command="{Binding DownloadCommand}"
                                Content="ACCEPT"
                                IsDefault="True"
                                Style="{StaticResource MaterialDesignFlatButton}">
                            <Button.CommandParameter>
                                <system:Boolean>True</system:Boolean>
                            </Button.CommandParameter>
                        </Button>

                        <Button Margin="0,8,8,0"
                                Command="{x:Static materialDesign:DialogHost.CloseDialogCommand}"
                                Content="CANCEL"
                                IsCancel="True"
                                Style="{StaticResource MaterialDesignFlatButton}">
                            <Button.CommandParameter>
                                <system:Boolean>False</system:Boolean>
                            </Button.CommandParameter>
                        </Button>
                    </StackPanel>

                    <TextBox Margin="0,8,0,8"
                             HorizontalAlignment="Stretch"
                             Text="{Binding DownloadPath, UpdateSourceTrigger=PropertyChanged, Delay=250}" />
                </DockPanel>
            </materialDesign:DialogHost.DialogContent>

            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="*" />
                    <RowDefinition Height="8" />
                    <RowDefinition Height="Auto" />
                </Grid.RowDefinitions>

                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="8" />
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="8" />
                </Grid.ColumnDefinitions>

                <!--  Search  -->

                <materialDesign:Card Grid.Row="0"
                                     Grid.Column="1"
                                     Margin="16"
                                     Padding="32,16">
                    <TextBox VerticalAlignment="Center"
                             materialDesign:TextFieldAssist.HasClearButton="True"
                             Style="{StaticResource MaterialDesignFloatingHintTextBox}"
                             Text="{Binding TextFilter, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged, Delay=125}">
                        <materialDesign:HintAssist.Hint>
                            <StackPanel Margin="-2,0,0,0" Orientation="Horizontal">
                                <iconpacks:PackIconFontAwesome Margin="0,0,2,0" Kind="SearchSolid" />
                                <TextBlock Text="Filter" />
                            </StackPanel>
                        </materialDesign:HintAssist.Hint>
                    </TextBox>
                </materialDesign:Card>

                <!--  Tracks  -->

                <ItemsControl Grid.Row="1"
                              Grid.Column="1"
                              ItemsSource="{Binding Tracks, Mode=OneTime}">
                    <ItemsControl.ItemsPanel>
                        <ItemsPanelTemplate>
                            <VirtualizingStackPanel IsItemsHost="True"
                                                    IsVirtualizing="True"
                                                    VirtualizationMode="Recycling" />
                        </ItemsPanelTemplate>
                    </ItemsControl.ItemsPanel>

                    <ItemsControl.Template>
                        <ControlTemplate TargetType="ItemsControl">
                            <Border Background="{TemplateBinding Background}"
                                    BorderBrush="{TemplateBinding BorderBrush}"
                                    BorderThickness="{TemplateBinding BorderThickness}">
                                <ScrollViewer Padding="{TemplateBinding Padding}"
                                              CanContentScroll="True"
                                              Focusable="False"
                                              VerticalScrollBarVisibility="Hidden">
                                    <ItemsPresenter />
                                </ScrollViewer>
                            </Border>
                        </ControlTemplate>
                    </ItemsControl.Template>

                    <ItemsControl.ItemTemplate>
                        <DataTemplate DataType="{x:Type core:TrackViewModel}">
                            <materialDesign:Card Margin="16" Padding="32">
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="60" />
                                        <ColumnDefinition Width="8" />
                                        <ColumnDefinition Width="*" />
                                    </Grid.ColumnDefinitions>

                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="*" />
                                        <RowDefinition Height="Auto" />
                                        <RowDefinition Height="Auto" />
                                        <RowDefinition Height="8" />
                                        <RowDefinition Height="Auto" />
                                    </Grid.RowDefinitions>

                                    <!--  Cover Art  -->
                                    <materialDesign:Badged Grid.Column="0"
                                                           BadgeColorZoneMode="PrimaryMid"
                                                           Focusable="False"
                                                           ToolTip="Play Track">
                                        <materialDesign:Badged.Badge>
                                            <materialDesign:PackIcon Kind="Play" />
                                        </materialDesign:Badged.Badge>

                                        <Button Width="60"
                                                Height="60"
                                                Padding="0"
                                                materialDesign:RippleAssist.RippleOnTop="True"
                                                Background="Transparent"
                                                BorderThickness="0"
                                                Command="{Binding Data.PlayCommand, Source={StaticResource BindingProxy}}"
                                                CommandParameter="{Binding}"
                                                Focusable="True"
                                                UseLayoutRounding="True">
                                            <Image RenderOptions.BitmapScalingMode="NearestNeighbor"
                                                   RenderOptions.EdgeMode="Aliased"
                                                   SnapsToDevicePixels="True"
                                                   Source="{Binding ImageUrl, Mode=OneTime}" />
                                        </Button>
                                    </materialDesign:Badged>

                                    <!--  Title Info  -->
                                    <TextBlock Grid.Column="2" Style="{StaticResource MaterialDesignHeadline5TextBlock}">
                                        <Run Text="{Binding Title}" />
                                        <LineBreak />
                                        <Run FontSize="16" Text="{Binding ArtistsTitle}" />
                                        <LineBreak />
                                        <Run FontSize="14" Text="{Binding Version}" />
                                    </TextBlock>

                                    <!--  Flags  -->
                                    <DockPanel Grid.Row="1"
                                               Grid.Column="0"
                                               Grid.ColumnSpan="3"
                                               IsHitTestVisible="False">
                                        <CheckBox Content="Streamable" IsChecked="{Binding Streamable}" />
                                        <CheckBox Margin="32,0"
                                                  Content="Downloadable"
                                                  IsChecked="{Binding Downloadable}" />
                                        <CheckBox Content="Early Access" IsChecked="{Binding InEarlyAccess}" />
                                    </DockPanel>

                                    <!--  Tags  -->
                                    <ItemsControl Grid.Row="4"
                                                  Grid.Column="0"
                                                  Grid.ColumnSpan="3"
                                                  IsHitTestVisible="False"
                                                  ItemsSource="{Binding Tags}">
                                        <ItemsControl.ItemTemplate>
                                            <DataTemplate>
                                                <materialDesign:Chip Margin="0,0,4,0" Content="{Binding}" />
                                            </DataTemplate>
                                        </ItemsControl.ItemTemplate>

                                        <ItemsControl.ItemsPanel>
                                            <ItemsPanelTemplate>
                                                <StackPanel Orientation="Horizontal" />
                                            </ItemsPanelTemplate>
                                        </ItemsControl.ItemsPanel>
                                    </ItemsControl>
                                </Grid>
                            </materialDesign:Card>
                        </DataTemplate>
                    </ItemsControl.ItemTemplate>
                </ItemsControl>

                <!--  Download  -->

                <Button Grid.Row="1"
                        Grid.Column="1"
                        HorizontalAlignment="Right"
                        VerticalAlignment="Bottom"
                        Command="{x:Static materialDesign:DialogHost.OpenDialogCommand}"
                        Style="{StaticResource MaterialDesignFloatingActionAccentButton}">
                    <Button.ToolTip>
                        <TextBlock Margin="8,0,0,0" VerticalAlignment="Center">
                            <Run Text="Download all" />
                            <Run Text="{Binding Tracks.Count, Mode=OneWay}" />
                            <Run Text="Tracks now" />
                        </TextBlock>
                    </Button.ToolTip>

                    <iconpacks:PackIconFontAwesome Kind="DownloadSolid" />
                </Button>

                <!--  Progress  -->

                <ContentControl Grid.Row="3" Grid.ColumnSpan="3">
                    <ProgressBar Maximum="100">
                        <i:Interaction.Behaviors>
                            <local:SmoothProgressBehavior Percentage="{Binding Progress.Current.Value, Mode=OneWay}" />
                        </i:Interaction.Behaviors>
                    </ProgressBar>

                    <ContentControl.Style>
                        <Style TargetType="{x:Type ContentControl}">
                            <Setter Property="Visibility" Value="Collapsed" />
                            <Style.Triggers>
                                <DataTrigger Binding="{Binding IsLoading}" Value="True">
                                    <Setter Property="Visibility" Value="Visible" />
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </ContentControl.Style>
                </ContentControl>
            </Grid>
        </materialDesign:DialogHost>
    </materialDesign:TransitioningContent>
</mahControls:MetroWindow>
