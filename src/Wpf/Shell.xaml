<mahControls:MetroWindow x:Class="SoftThorn.Monstercat.Browser.Wpf.Shell"
                         xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
                         xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
                         xmlns:core="clr-namespace:SoftThorn.Monstercat.Browser.Core;assembly=SoftThorn.Monstercat.Browser.Core"
                         xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
                         xmlns:i="http://schemas.microsoft.com/xaml/behaviors"
                         xmlns:iconpacks="clr-namespace:MahApps.Metro.IconPacks;assembly=MahApps.Metro.IconPacks.FontAwesome"
                         xmlns:local="clr-namespace:SoftThorn.Monstercat.Browser.Wpf"
                         xmlns:mahControls="http://metro.mahapps.com/winfx/xaml/controls"
                         xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
                         xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
                         Title="SoftThorn.Monstercat.Browser.Wpf"
                         Width="800"
                         Height="820"
                         d:DataContext="{d:DesignInstance Type=core:ShellViewModel,
                                                          IsDesignTimeCreatable=False}"
                         Background="{DynamicResource MaterialDesignPaper}"
                         BorderBrush="#FF673AB7"
                         FontFamily="{DynamicResource MaterialDesignFont}"
                         GlowBrush="{DynamicResource PrimaryHueMidBrush}"
                         TextElement.FontSize="13"
                         TextElement.FontWeight="Regular"
                         TextElement.Foreground="{DynamicResource MaterialDesignBody}"
                         TextOptions.TextFormattingMode="Ideal"
                         TextOptions.TextRenderingMode="Auto"
                         TitleCharacterCasing="Normal"
                         WindowTitleBrush="#FF673AB7"
                         mc:Ignorable="d">

    <mahControls:MetroWindow.Resources>
        <local:BindingProxy x:Key="BindingProxy" Data="{Binding}" />
    </mahControls:MetroWindow.Resources>

    <materialDesign:TransitioningContent>
        <materialDesign:TransitioningContent.OpeningEffects>
            <materialDesign:TransitionEffect Kind="FadeIn" />
            <materialDesign:TransitionEffect Kind="SlideInFromBottom" />
        </materialDesign:TransitioningContent.OpeningEffects>

        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto" />
                <RowDefinition Height="*" />
                <RowDefinition Height="8" />
                <RowDefinition Height="Auto" />
            </Grid.RowDefinitions>

            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="8" />
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="8" />
            </Grid.ColumnDefinitions>

            <!--  Search  -->

            <materialDesign:Card Grid.Row="0"
                                 Grid.Column="1"
                                 Margin="16"
                                 Padding="32,16">
                <TextBox VerticalAlignment="Center"
                         materialDesign:TextFieldAssist.HasClearButton="True"
                         Style="{StaticResource MaterialDesignFloatingHintTextBox}"
                         Text="{Binding TextFilter, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged, Delay=125}">
                    <materialDesign:HintAssist.Hint>
                        <StackPanel Margin="-2,0,0,0" Orientation="Horizontal">
                            <iconpacks:PackIconFontAwesome Margin="0,0,2,0" Kind="SearchSolid" />
                            <TextBlock Text="Filter" />
                        </StackPanel>
                    </materialDesign:HintAssist.Hint>
                </TextBox>
            </materialDesign:Card>

            <!--  Tracks  -->

            <ItemsControl Grid.Row="1"
                          Grid.Column="1"
                          ItemsSource="{Binding Tracks, Mode=OneTime}">
                <ItemsControl.ItemsPanel>
                    <ItemsPanelTemplate>
                        <VirtualizingStackPanel IsItemsHost="True"
                                                IsVirtualizing="True"
                                                VirtualizationMode="Recycling" />
                    </ItemsPanelTemplate>
                </ItemsControl.ItemsPanel>

                <ItemsControl.Template>
                    <ControlTemplate TargetType="ItemsControl">
                        <Border Background="{TemplateBinding Background}"
                                BorderBrush="{TemplateBinding BorderBrush}"
                                BorderThickness="{TemplateBinding BorderThickness}">
                            <ScrollViewer Padding="{TemplateBinding Padding}"
                                          CanContentScroll="True"
                                          Focusable="False"
                                          VerticalScrollBarVisibility="Hidden">
                                <ItemsPresenter />
                            </ScrollViewer>
                        </Border>
                    </ControlTemplate>
                </ItemsControl.Template>

                <ItemsControl.ItemTemplate>
                    <DataTemplate DataType="{x:Type core:TrackViewModel}">
                        <materialDesign:Card Margin="16" Padding="32">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="60" />
                                    <ColumnDefinition Width="8" />
                                    <ColumnDefinition Width="*" />
                                </Grid.ColumnDefinitions>

                                <Grid.RowDefinitions>
                                    <RowDefinition Height="*" />
                                    <RowDefinition Height="Auto" />
                                    <RowDefinition Height="Auto" />
                                    <RowDefinition Height="8" />
                                    <RowDefinition Height="Auto" />
                                </Grid.RowDefinitions>

                                <!--  Cover Art  -->
                                <materialDesign:Badged Grid.Column="0"
                                                       BadgeColorZoneMode="PrimaryMid"
                                                       Focusable="False"
                                                       ToolTip="Play Track">
                                    <materialDesign:Badged.Badge>
                                        <materialDesign:PackIcon Kind="Play" />
                                    </materialDesign:Badged.Badge>

                                    <Button Width="60"
                                            Height="60"
                                            Padding="0"
                                            materialDesign:RippleAssist.RippleOnTop="True"
                                            Background="Transparent"
                                            BorderThickness="0"
                                            Command="{Binding Data.PlayCommand, Source={StaticResource BindingProxy}}"
                                            CommandParameter="{Binding}"
                                            Focusable="True"
                                            UseLayoutRounding="True">
                                        <Image RenderOptions.BitmapScalingMode="NearestNeighbor"
                                               RenderOptions.EdgeMode="Aliased"
                                               SnapsToDevicePixels="True"
                                               Source="{Binding ImageUrl, Mode=OneTime}" />
                                    </Button>
                                </materialDesign:Badged>

                                <!--  Title Info  -->
                                <TextBlock Grid.Column="2" Style="{StaticResource MaterialDesignHeadline5TextBlock}">
                                    <Run Text="{Binding Title}" />
                                    <LineBreak />
                                    <Run FontSize="16" Text="{Binding ArtistsTitle}" />
                                    <LineBreak />
                                    <Run FontSize="14" Text="{Binding Version}" />
                                </TextBlock>

                                <!--  Flags  -->
                                <DockPanel Grid.Row="1"
                                           Grid.Column="0"
                                           Grid.ColumnSpan="3"
                                           IsHitTestVisible="False">
                                    <CheckBox Background="{DynamicResource PrimaryHueLightBrush}"
                                              Content="Streamable"
                                              IsChecked="{Binding Streamable}" />
                                    <CheckBox Margin="32,0"
                                              Background="{DynamicResource PrimaryHueLightBrush}"
                                              Content="Downloadable"
                                              IsChecked="{Binding Downloadable}" />
                                    <CheckBox Background="{DynamicResource PrimaryHueLightBrush}"
                                              Content="Early Access"
                                              IsChecked="{Binding InEarlyAccess}" />
                                </DockPanel>

                                <!--  Tags  -->
                                <ItemsControl Grid.Row="4"
                                              Grid.Column="0"
                                              Grid.ColumnSpan="3"
                                              IsHitTestVisible="False"
                                              ItemsSource="{Binding Tags}">
                                    <ItemsControl.ItemTemplate>
                                        <DataTemplate>
                                            <RadioButton Margin="0,0,4,4"
                                                         Content="{Binding}"
                                                         IsChecked="True"
                                                         Style="{StaticResource MaterialDesignChoiceChipPrimaryRadioButton}" />
                                        </DataTemplate>
                                    </ItemsControl.ItemTemplate>

                                    <ItemsControl.ItemsPanel>
                                        <ItemsPanelTemplate>
                                            <StackPanel Orientation="Horizontal" />
                                        </ItemsPanelTemplate>
                                    </ItemsControl.ItemsPanel>
                                </ItemsControl>
                            </Grid>
                        </materialDesign:Card>
                    </DataTemplate>
                </ItemsControl.ItemTemplate>
            </ItemsControl>

            <!--  Download  -->

            <Button Grid.Row="1"
                    Grid.Column="1"
                    HorizontalAlignment="Right"
                    VerticalAlignment="Bottom"
                    materialDesign:ButtonProgressAssist.IsIndicatorVisible="{Binding Downloads.IsDownLoading}"
                    materialDesign:ButtonProgressAssist.Value="{Binding Downloads.Progress.Current.Value}"
                    Click="Download_Click"
                    Style="{StaticResource MaterialDesignFloatingActionAccentButton}">
                <Button.ToolTip>
                    <TextBlock Margin="8,0,0,0" VerticalAlignment="Center">
                        <Run Text="Download all" />
                        <Run Text="{Binding Tracks.Count, Mode=OneWay}" />
                        <Run Text="Tracks now" />
                    </TextBlock>
                </Button.ToolTip>

                <iconpacks:PackIconFontAwesome Kind="DownloadSolid" />
            </Button>

            <!--  Progress  -->

            <ContentControl Grid.Row="3" Grid.ColumnSpan="3">
                <ProgressBar Maximum="100">
                    <i:Interaction.Behaviors>
                        <local:SmoothProgressBehavior Percentage="{Binding Progress.Current.Value, Mode=OneWay}" />
                    </i:Interaction.Behaviors>
                </ProgressBar>

                <ContentControl.Style>
                    <Style TargetType="{x:Type ContentControl}">
                        <Setter Property="Visibility" Value="Collapsed" />
                        <Style.Triggers>
                            <DataTrigger Binding="{Binding IsLoading}" Value="True">
                                <Setter Property="Visibility" Value="Visible" />
                            </DataTrigger>
                        </Style.Triggers>
                    </Style>
                </ContentControl.Style>
            </ContentControl>
        </Grid>
    </materialDesign:TransitioningContent>
</mahControls:MetroWindow>
